<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="css/login.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!-- <a class="navbar-brand" href="#">Navbar</a> -->
            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="home.html">Home</a></li>
                    <li><a href="scan.html">Network</a></li>
                    <li><a href="benchmarks.html">Upload CIS Benchmark</a></li>
                    <li><a href="register.html">Add users</a></li>
                    <li><a href="baseline.html">Configure Baseline</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#" id="Logout">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="row mb-3">
        <div class="col-md-6">
            <select id="benchmark-select" class="form-select">
                <option selected>Select a benchmark</option>
                <!-- Options will be populated here by JavaScript -->
            </select>
        </div>
        <div class="col-md-6">
            <button id="load-benchmark" class="btn btn-primary">Load Benchmark</button>
            <button id="create-baseline" class="btn btn-secondary">Create Baseline</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table id="benchmark-table" class="table table-bordered policy-table">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>ID</th>
                        <th>Category</th>
                        <th>Setting</th>
                        <th>Recommended Value</th>
                        <th>New Value</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be populated here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>


    <script>
        $(document).ready(function () {
            var settings = {
                "url": "http://192.168.126.148:3000/allBenchmarks",
                "method": "GET",
                "timeout": 0,
            };

            $.ajax(settings).done(function (response) {
                response.forEach(function (item) {
                    $('#benchmark-select').append('<option value="' + item.csv_filename + '">' + item.csv_filename + '</option>');
                });
            });

            $('#load-benchmark').click(function () {
                var selectedBenchmark = $('#benchmark-select').val();
                if (selectedBenchmark !== "Select a benchmark") {
                    $.get('http://192.168.126.148:3000/benchmark', { filename: selectedBenchmark }, function (data) {
                        // Clear previous table data
                        $('#benchmark-table tbody').empty();

                        // Split data into rows
                        var rows = data.split('\n');

                        // Loop through rows and create table rows
                        rows.forEach(function (row) {
                            var columns = row.split(',');
                            if (columns.length === 4) {
                                var newRow = '<tr data-policyName="' + columns[2] + '">' +
                                    '<td><input type="checkbox" class="form-check-input select-policy" value="' + columns[2] + '"></td>' +
                                    '<td>' + columns[0] + '</td>' +
                                    '<td>' + columns[1] + '</td>' +
                                    '<td class="policy-name">' + columns[2] + '</td>' +
                                    '<td>' + columns[3] + '</td>' +
                                    '<td><input type="text" class="form-control new-value-input" placeholder="Enter new value"></td>' +
                                    '</tr>';
                                $('#benchmark-table tbody').append(newRow);
                            }
                        });
                    });
                }
            });

            // Click event handler for the Create Baseline button
            $('#create-baseline').click(function () {
                // Object to store selected policies and new values
                var selectedPolicies = {};

                $('.select-policy:checked').each(function () {
                    var policyName = $(this).closest('tr').find('.policy-name').text();
                    var newValue = $(this).closest('tr').find('.new-value-input').val().trim();

                    // Check if newValue is not blank
                    if (newValue !== '') {
                        selectedPolicies[policyName] = newValue;
                    }
                });

                // Check if any policies are selected
                if (Object.keys(selectedPolicies).length === 0) {
                    alert('No policies selected.');
                    return;
                }

                console.log(selectedPolicies);
            });



        });
    </script>
</body>

</html>